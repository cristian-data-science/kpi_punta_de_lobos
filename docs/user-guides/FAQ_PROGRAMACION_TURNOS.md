# ‚ùì FAQ - Sistema de Programaci√≥n de Turnos

## Preguntas Frecuentes y Soluci√≥n de Problemas

---

## üìö Conceptos B√°sicos

### ¬øQu√© es una "plantilla de turno"?
Una plantilla de turno es un turno predefinido que se repite seg√∫n un patr√≥n. Por ejemplo, "GP1 - Martes 9-18h en Semana 1" es una plantilla. Cuando asignas una persona, est√°s vincul√°ndola a esa plantilla para un mes espec√≠fico.

### ¬øQu√© significa el "ciclo de 4 semanas"?
Los turnos se organizan en un ciclo que se repite cada 4 semanas. Cada guardia (GP1-GP4) tiene patrones diferentes seg√∫n la semana del ciclo (1, 2, 3 o 4).

### ¬øCu√°l es la diferencia entre `turnos` y `turnos_v2`?
- **`turnos`**: Tabla original para turnos del d√≠a a d√≠a (registros reales completados)
- **`turnos_v2`**: Tabla nueva para plantillas asignables (programaci√≥n mensual)

Son sistemas complementarios pero independientes.

---

## üéØ Uso del Sistema

### ¬øC√≥mo elijo qu√© escenario usar?

**Por Temporada**:
- **Baja**: Abril-Octubre (menos visitantes, turnos reducidos)
- **Alta**: Noviembre-Marzo (m√°s visitantes, m√°s cobertura)

**Por Horario**:
- **Invierno**: Mayo-Septiembre (horarios m√°s cortos)
- **Verano**: Octubre-Abril (horarios extendidos, m√°s tarde)

**Combinaciones recomendadas**:
```
Enero:      Alta - Verano      (m√°xima temporada)
Febrero:    Alta - Verano
Marzo:      Alta - Verano
Abril:      Baja - Invierno    (transici√≥n)
Mayo:       Baja - Invierno
Junio:      Baja - Invierno
Julio:      Baja - Invierno
Agosto:     Baja - Invierno
Septiembre: Baja - Invierno
Octubre:    Alta - Invierno    (pre-temporada)
Noviembre:  Alta - Verano      (inicio temporada)
Diciembre:  Alta - Verano
```

### ¬øPuedo cambiar de escenario a mitad de mes?
No es recomendable. Los escenarios est√°n dise√±ados para aplicarse a un mes completo. Si necesitas hacer cambios, es mejor:
1. Desasignar todos los turnos del mes
2. Cambiar el escenario
3. Re-asignar las personas

### ¬øQu√© pasa si asigno a alguien y luego cambio de persona?
El sistema permite cambiar la asignaci√≥n en cualquier momento antes de que el turno pase a estado "completado". Simplemente:
1. Haz clic en el turno asignado
2. Selecciona la nueva persona
3. La asignaci√≥n anterior se sobrescribe autom√°ticamente

---

## üí∞ C√°lculos y Pagos

### ¬øC√≥mo se calculan los montos?
F√≥rmula b√°sica:
```
monto_turno = tarifa_base * multiplicador_guardia

Donde:
- tarifa_base:
  * Lun-Vie: $30.000
  * S√°bado: $40.000
  * Domingo: $50.000

- multiplicador_guardia (configurables):
  * GP1: 1.0
  * GP2: 1.0
  * GP3: 1.0
  * GP4: 1.0
  * Voluntario: 0.5
```

### ¬øPuedo cambiar las tarifas?
S√≠, ejecutando en Supabase:
```sql
UPDATE configuracion_pagos 
SET 
  tarifa_dia_semana = 35000,
  tarifa_sabado = 45000,
  tarifa_domingo = 55000
WHERE es_actual = true;
```

### ¬øLos cambios de tarifa afectan turnos ya asignados?
No. Los montos se calculan en tiempo real usando las tarifas actuales. Si quieres "congelar" un monto para un mes espec√≠fico, necesitar√°s agregar un campo adicional `monto_fijo` en la tabla.

### ¬øPor qu√© los s√°bados y domingos pagan m√°s?
Es una configuraci√≥n predeterminada que refleja que los fines de semana suelen tener mayor afluencia de visitantes y requieren mayor incentivo para el personal.

---

## üîß Problemas T√©cnicos

### ERROR: "No se pueden cargar turnos"

**S√≠ntoma**: P√°gina en blanco o mensaje de error al cargar turnos.

**Soluciones**:
1. Verifica que ejecutaste ambos scripts SQL:
   ```sql
   SELECT COUNT(*) FROM turnos_v2;  -- Debe ser ~250
   ```

2. Verifica la conexi√≥n a Supabase:
   - Revisa variables de entorno (`.env.local`)
   - Confirma que `VITE_SUPABASE_URL` y `VITE_SUPABASE_ANON_KEY` est√°n configurados

3. Abre la consola del navegador (F12) y busca errores JavaScript

### ERROR: "No aparecen personas para asignar"

**S√≠ntoma**: Modal de asignaci√≥n se abre pero no muestra personas.

**Soluciones**:
1. Verifica que tienes personas en la BD:
   ```sql
   SELECT * FROM personas WHERE estado = 'activo';
   ```

2. Si no hay personas activas:
   ```sql
   INSERT INTO personas (nombre, rut, tipo, estado) VALUES
   ('Juan P√©rez', '12345678-9', 'guia', 'activo');
   ```

3. Actualiza personas inactivas:
   ```sql
   UPDATE personas SET estado = 'activo' WHERE id = 'tu-uuid';
   ```

### ERROR: "Montos aparecen en $0"

**S√≠ntoma**: Dashboard de estad√≠sticas muestra $0 en todos los montos.

**Soluciones**:
1. Verifica configuraci√≥n de pagos:
   ```sql
   SELECT * FROM configuracion_pagos WHERE es_actual = true;
   ```

2. Si est√° vac√≠o, ejecuta de nuevo la secci√≥n de INSERT de `crear_turnos_v2.sql`:
   ```sql
   INSERT INTO configuracion_pagos (...) VALUES (...);
   ```

3. Verifica que los campos de tarifa no sean NULL:
   ```sql
   UPDATE configuracion_pagos 
   SET 
     tarifa_dia_semana = COALESCE(tarifa_dia_semana, 30000),
     tarifa_sabado = COALESCE(tarifa_sabado, 40000),
     tarifa_domingo = COALESCE(tarifa_domingo, 50000)
   WHERE es_actual = true;
   ```

### ERROR: Calendario no muestra turnos

**S√≠ntoma**: Calendario semanal aparece vac√≠o.

**Soluciones**:
1. Verifica que la semana mostrada tiene turnos:
   ```sql
   SELECT * FROM turnos_v2 
   WHERE temporada = 'baja' 
   AND horario = 'invierno'
   LIMIT 10;
   ```

2. Cambia de semana usando los botones ‚óÄ ‚ñ∂

3. Verifica que los filtros de escenario (temporada/horario) coincidan con las plantillas que existen

4. Revisa la consola del navegador para errores en `convertirTurnosABloques()`

### ERROR: "Duplicate key violation" al crear plantilla

**S√≠ntoma**: Error al intentar insertar plantilla de turno.

**Causa**: Ya existe una plantilla con la misma combinaci√≥n de:
- codigo_turno + temporada + horario + semana_ciclo + dia_semana + hora_inicio + hora_fin

**Soluci√≥n**: Esto es normal y esperado. El `ON CONFLICT DO NOTHING` en los scripts SQL previene duplicados. Si est√°s creando manualmente, verifica primero:
```sql
SELECT * FROM turnos_v2 
WHERE codigo_turno = 'GP1' 
AND temporada = 'baja'
AND horario = 'invierno'
AND semana_ciclo = 1
AND dia_semana = 'martes';
```

---

## üìä Dashboard y Estad√≠sticas

### ¬øPor qu√© las estad√≠sticas est√°n vac√≠as?

**Causa**: No hay turnos asignados para el mes/a√±o seleccionado.

**Soluci√≥n**: 
1. Asigna al menos una persona a un turno
2. Las estad√≠sticas solo muestran datos de turnos con estado "asignado" o "completado"
3. Verifica que mes/a√±o en filtros coincidan con turnos asignados

### ¬øPuedo ver estad√≠sticas de meses pasados?

S√≠, simplemente cambia el mes y a√±o en los filtros superiores. El dashboard se recalcular√° autom√°ticamente.

### ¬øC√≥mo interpreto "Horas Totales"?

Es la suma de todas las horas trabajadas en el mes. Se calcula como:
```
suma de (hora_fin - hora_inicio) para cada turno asignado
```

Ejemplo: 8 turnos de 9 horas = 72 horas totales

---

## üé® Personalizaci√≥n

### ¬øPuedo agregar un quinto tipo de guardia (GP5)?

S√≠, pero requiere:
1. Agregar plantillas manualmente en Supabase:
   ```sql
   INSERT INTO turnos_v2 (codigo_turno, temporada, horario, ...) VALUES
   ('GP5', 'baja', 'invierno', 1, 'lunes', '10:00', '19:00', ...);
   ```

2. Agregar multiplicador en configuraci√≥n:
   ```sql
   ALTER TABLE configuracion_pagos 
   ADD COLUMN multiplicador_gp5 DECIMAL(5,2) DEFAULT 1.0;
   ```

3. Actualizar servicio `calcularEstadisticasMes()` para incluir GP5 en c√°lculos

### ¬øPuedo cambiar los nombres de GP1, GP2, etc?

S√≠, actualizando el campo `puesto` en las plantillas:
```sql
UPDATE turnos_v2 
SET puesto = 'Supervisor Principal' 
WHERE codigo_turno = 'GP1';
```

El c√≥digo `GP1` se mantiene, pero el label mostrado cambia.

### ¬øPuedo agregar m√°s d√≠as festivos?

Actualmente el sistema solo tiene tarifa para "festivos" pero no maneja fechas espec√≠ficas. Para implementarlo:

1. Crea tabla de festivos:
   ```sql
   CREATE TABLE festivos (
     fecha DATE PRIMARY KEY,
     nombre TEXT
   );
   
   INSERT INTO festivos VALUES 
   ('2026-01-01', 'A√±o Nuevo'),
   ('2026-09-18', 'Fiestas Patrias');
   ```

2. Modifica `calcularEstadisticasMes()` para verificar si `turno.fecha` est√° en tabla festivos

---

## üîÑ Flujo de Trabajo Avanzado

### ¬øC√≥mo programo todo un a√±o?

Recomendaci√≥n:
1. Programa primero meses de alta temporada (m√°s cr√≠tico)
2. Luego meses de baja temporada
3. Mant√©n un buffer de 1 mes de anticipaci√≥n

Ejemplo en Octubre 2025:
```
‚úÖ Noviembre 2025 - programado
‚úÖ Diciembre 2025 - programado
‚è≥ Enero 2026 - en proceso
‚ùå Febrero 2026 - pendiente
```

### ¬øPuedo copiar asignaciones de un mes a otro?

Actualmente no hay funci√≥n autom√°tica, pero puedes:
1. Exportar estad√≠sticas del mes A a Excel
2. Usar eso como referencia para programar mes B

**Pr√≥xima mejora sugerida**: Bot√≥n "Copiar del mes anterior"

### ¬øC√≥mo manejo vacaciones o ausencias?

Opci√≥n 1: No asignar a esa persona en esas semanas
Opci√≥n 2: Asignar y luego cambiar estado a "cancelado"
Opci√≥n 3: Asignar persona temporal/reemplazo

### ¬øPuedo tener dos personas en el mismo turno?

No directamente. La tabla est√° dise√±ada para 1 persona por turno. Si necesitas duplicar cobertura:
1. Crea una segunda plantilla manualmente con c√≥digo "GP1-B"
2. Asigna la segunda persona a esa plantilla

---

## üöÄ Performance y Escalabilidad

### ¬øCu√°ntos turnos puede manejar el sistema?

La tabla `turnos_v2` puede manejar millones de registros. Actualmente tienes ~250 plantillas base. Cuando asignes personas, tendr√°s:

```
250 plantillas √ó 12 meses = 3,000 registros por a√±o
```

Esto es muy manejable para PostgreSQL.

### ¬øEl calendario se vuelve lento con muchos turnos?

El componente `WeeklySchedule` solo muestra 1 semana a la vez (m√°ximo ~30-40 bloques), por lo que el performance es excelente incluso con miles de turnos totales.

### ¬øPuedo usar este sistema con m√∫ltiples ubicaciones?

S√≠, el campo `ubicacion` existe en la tabla. Podr√≠as:
1. Duplicar plantillas con diferentes ubicaciones
2. Agregar filtro por ubicaci√≥n en la p√°gina
3. Mostrar m√∫ltiples calendarios (uno por ubicaci√≥n)

---

## üì± Acceso y Permisos

### ¬øEl sistema funciona en m√≥vil?

S√≠, la UI usa TailwindCSS responsive. Sin embargo, la experiencia es mejor en tablet o desktop debido a la complejidad del calendario.

### ¬øPuedo dar acceso de solo lectura a ciertos usuarios?

Actualmente no hay sistema de roles. Todos los usuarios autenticados tienen acceso completo. Para implementar roles:
1. Agregar tabla `usuarios` con campo `rol`
2. Implementar RLS policies en Supabase
3. Condicionar botones de acci√≥n seg√∫n rol en el frontend

---

## üîí Seguridad

### ¬øLos datos est√°n protegidos?

S√≠:
- **RLS habilitado** en Supabase para ambas tablas
- **Pol√≠ticas permisivas** actualmente (para desarrollo)
- En producci√≥n, debes actualizar las policies a algo como:
  ```sql
  CREATE POLICY "Solo admin puede modificar" ON turnos_v2
    FOR ALL USING (auth.jwt() ->> 'role' = 'admin');
  ```

### ¬øPuedo hacer backup de los turnos?

S√≠, desde Supabase Dashboard:
1. Settings ‚Üí Database ‚Üí Backups
2. O exporta manualmente:
   ```sql
   COPY turnos_v2 TO '/tmp/turnos_backup.csv' CSV HEADER;
   ```

---

## üêõ Reportar Problemas

Si encuentras un bug no documentado aqu√≠:

1. Verifica la consola del navegador (F12) para errores
2. Revisa que los scripts SQL se ejecutaron correctamente
3. Confirma que tienes la √∫ltima versi√≥n del c√≥digo
4. Documenta:
   - Qu√© estabas haciendo
   - Qu√© esperabas que pasara
   - Qu√© pas√≥ en realidad
   - Mensaje de error (si aplica)

---

## üìö Recursos Adicionales

- **INSTRUCCIONES_PROGRAMACION_TURNOS.md** - Gu√≠a de instalaci√≥n paso a paso
- **RESUMEN_SISTEMA_PROGRAMACION.md** - Documentaci√≥n t√©cnica completa
- **MATRIZ_ESCENARIOS_TURNOS.md** - Comparativa visual de los 4 escenarios
- **sql/crear_turnos_v2.sql** - Script principal de base de datos
- **sql/plantillas_turnos_completas.sql** - Script de plantillas adicionales

---

**¬øTu pregunta no est√° aqu√≠?** 
Revisa los comentarios en el c√≥digo fuente o consulta la documentaci√≥n de Supabase.

**Desarrollado para Punta de Lobos** üåä
